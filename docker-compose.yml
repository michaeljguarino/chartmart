services:
  db:
    image: postgres:14
    restart: always
    ports:
    - 5432:5432
    environment:
      POSTGRES_PASSWORD: postgres
    volumes:
    - database_data:/var/lib/postgresql/data
  cockroach:
    image: cockroachdb/cockroach:v24.1.3
    restart: always
    ports:
    - 26257:26257
    - 8080:8080
    command: start-single-node --certs-dir /cockroach/certs
    environment:
    - COCKROACH_DATABASE=plural
    - COCKROACH_USER=plrl
    - COCKROACH_PASSWORD=plural
    volumes:
    - roach_data:/cockroach/cockroach-data
    - ./test-certs:/cockroach/certs
  rabbit:
    image: rabbitmq:3-management
    hostname: "rabbit1"
    environment:
      RABBITMQ_ERLANG_COOKIE: "SWQOKODSQALRPCLNMEQG"
      RABBITMQ_DEFAULT_USER: "rabbitmq"
      RABBITMQ_DEFAULT_PASS: "rabbitmq"
      RABBITMQ_DEFAULT_VHOST: "/"
    ports:
      - "15672:15672"
      - "5672:5672"
  influxdb:
    image: influxdb:1.8
    volumes:
    # Mount for influxdb data directory and configuration
    - influxdb:/var/lib/influxdb
    environment:
    - INFLUXDB_HTTP_AUTH_ENABLED=true
    - INFLUXDB_ADMIN_USER=forge
    - INFLUXDB_ADMIN_PASSWORD=forgepwd
    - INFLUXDB_DB=plural
    ports:
    - "8086:8086"
  # chartmuseum:
  #   image: chartmuseum/chartmuseum:latest
  #   volumes:
  #   - ${HOME}/.gcp:/home/chartmuseum/.gcp:ro
  #   restart: always
  #   environment:
  #     PORT: 8080
  #     DEBUG: 1
  #     DEPTH: 1
  #     STORAGE: google
  #     CONTEXT_PATH: '/cm'
  #     STORAGE_GOOGLE_BUCKET: "mguarino-charts"
  #     STORAGE_GOOGLE_PREFIX: ""
  #     GOOGLE_APPLICATION_CREDENTIALS: "/home/chartmuseum/.gcp/key.json"
  #   ports:
  #   - 8080:8080
volumes:
  database_data:
    driver: local
  roach_data:
    driver: local
  influxdb:
    driver: local